{
  "table_name": "user_roles",
  "description": "Tabel junction untuk many-to-many relationship antara users dan roles",
  "phase": "phase_3",
  "columns": {
    "id": {
      "type": "BIGINT",
      "unsigned": true,
      "auto_increment": true,
      "primary_key": true,
      "description": "Primary key untuk tabel user_roles"
    },
    "user_id": {
      "type": "BIGINT",
      "unsigned": true,
      "not_null": true,
      "description": "Foreign key ke tabel users",
      "references": "users(id)"
    },
    "role_id": {
      "type": "BIGINT",
      "unsigned": true,
      "not_null": true,
      "description": "Foreign key ke tabel roles",
      "references": "roles(id)"
    },
    "assigned_by": {
      "type": "BIGINT",
      "unsigned": true,
      "nullable": true,
      "description": "User yang memberikan role ini",
      "references": "users(id)"
    },
    "assigned_at": {
      "type": "TIMESTAMP",
      "default": "CURRENT_TIMESTAMP",
      "not_null": true,
      "description": "Waktu role diassign ke user"
    },
    "expires_at": {
      "type": "TIMESTAMP",
      "nullable": true,
      "description": "Waktu role assignment berakhir (null untuk permanent)"
    },
    "is_active": {
      "type": "BOOLEAN",
      "default": true,
      "not_null": true,
      "description": "Status aktif dari role assignment"
    },
    "notes": {
      "type": "TEXT",
      "nullable": true,
      "description": "Catatan tambahan tentang role assignment"
    }
  },
  "constraints": {
    "unique_constraints": [
      {
        "name": "uk_user_roles_user_role",
        "columns": ["user_id", "role_id"],
        "description": "User tidak bisa memiliki role yang sama dua kali"
      }
    ],
    "foreign_key_constraints": [
      {
        "name": "fk_user_roles_user_id",
        "column": "user_id",
        "references": "users(id)",
        "on_delete": "CASCADE",
        "on_update": "CASCADE"
      },
      {
        "name": "fk_user_roles_role_id",
        "column": "role_id",
        "references": "roles(id)",
        "on_delete": "CASCADE",
        "on_update": "CASCADE"
      },
      {
        "name": "fk_user_roles_assigned_by",
        "column": "assigned_by",
        "references": "users(id)",
        "on_delete": "SET NULL",
        "on_update": "CASCADE"
      }
    ],
    "check_constraints": [
      {
        "name": "ck_user_roles_expiry_future",
        "condition": "expires_at IS NULL OR expires_at > assigned_at"
      }
    ]
  },
  "security": {
    "role_assignment_rules": {
      "self_assignment_prevention": true,
      "hierarchy_enforcement": true,
      "description": "User hanya bisa assign role dengan level lebih rendah atau sama"
    },
    "temporary_roles": {
      "enabled": true,
      "auto_expiry_check": true,
      "notification_before_expiry": "24h"
    },
    "audit_requirements": {
      "track_assignment_changes": true,
      "require_assignment_reason": false,
      "log_role_assignments": true
    }
  },
  "triggers": [
    {
      "name": "after_user_role_insert",
      "timing": "AFTER",
      "event": "INSERT",
      "logic": "Log role assignment ke audit trail"
    },
    {
      "name": "after_user_role_update",
      "timing": "AFTER",
      "event": "UPDATE",
      "logic": "Log role assignment changes ke audit trail"
    },
    {
      "name": "after_user_role_delete",
      "timing": "AFTER",
      "event": "DELETE",
      "logic": "Log role removal ke audit trail"
    }
  ]
}